<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Python Penetration Testing (Pentest)"><meta name="keywords" content=""><meta name="author" content="Ta Minh Huy,undefined"><meta name="copyright" content="Ta Minh Huy"><title>Python Penetration Testing (Pentest)【mhuyBlogsite】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><link rel="icon" href="/favicon.ico"><!-- script(src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML")--><script src="/js/mathjax/mathjax.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
});
</script><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Success',
    error: 'Error',
    noSupport: 'No Support'
  },
  gitment: {},
  valine: {},
}</script><meta name="generator" content="Hexo 6.2.0"></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="Post Folder">Overview</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">Catalog</div><div class="sidebar-toc-progress"><span class="progress-notice">Đã đọc</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-1-Python-with-Penetration-Testing-and-Networking"><span class="toc-number">1.</span> <span class="toc-text">Chapter 1: Python with Penetration Testing and Networking</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pham-vi-cua-pentesting"><span class="toc-number">1.1.</span> <span class="toc-text">Phạm vi của pentesting</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Can-thiet-cho-pentesting"><span class="toc-number">1.1.1.</span> <span class="toc-text">Cần thiết cho pentesting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dinh-nghia-pham-vi-cua-pentesting"><span class="toc-number">1.1.2.</span> <span class="toc-text">Định nghĩa phạm vi của pentesting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cac-cach-tiep-can-de-pentesting"><span class="toc-number">1.1.3.</span> <span class="toc-text">Các cách tiếp cận để pentesting:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Sockets"><span class="toc-number">1.2.</span> <span class="toc-text">Network Sockets</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Moving-on-to-the-practical"><span class="toc-number">1.2.1.</span> <span class="toc-text">Moving on to the practical</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Su-dung-bytearray-va-s-recv-into-buff"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">Sử dụng bytearray() và s.recv_into(buff)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Socket-exception"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Socket exception</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Userful-socket-methods"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">Userful socket methods</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-2-Scanning-Pentesting"><span class="toc-number">2.</span> <span class="toc-text">Chapter 2: Scanning Pentesting</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-check-live-systems-in-a-network-and-the-concept-of-a-live-system"><span class="toc-number">2.1.</span> <span class="toc-text">How to check live systems in a network and the concept of a live system</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ping-sweep"><span class="toc-number">2.1.1.</span> <span class="toc-text">Ping sweep</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-3-Sniffing-and-Penetration-Testing"><span class="toc-number">3.</span> <span class="toc-text">Chapter 3: Sniffing and Penetration Testing</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-a-network-sniffer"><span class="toc-number">3.1.</span> <span class="toc-text">Introducing a network sniffer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Passive-sniffing"><span class="toc-number">3.1.1.</span> <span class="toc-text">Passive sniffing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Active-sniffing"><span class="toc-number">3.1.2.</span> <span class="toc-text">Active sniffing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Implementing-a-network-sniffer-using-Python"><span class="toc-number">3.2.</span> <span class="toc-text">Implementing a network sniffer using Python</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4-Introducing-ARP-spoofing-and-implementing-it-using-Python"><span class="toc-number">4.</span> <span class="toc-text">Chapter 4: Introducing ARP spoofing and implementing it using Python</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-5-Tesing-the-security-system-using-custom-packet-crafting"><span class="toc-number">5.</span> <span class="toc-text">Chapter 5: Tesing the security system using custom packet crafting</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-Half-open-scan"><span class="toc-number">5.1.</span> <span class="toc-text">A Half-open scan</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">Ta Minh Huy</div><div class="author-info-description"></div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/huytm2k3" target="_blank">GitHub<i class="icon-dot bg-color7"></i></a><a class="links-button button-hover" href="mailto:huyat180522@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color9"></i></a><a class="links-button button-hover" href="https://www.facebook.com/profile.php?id=100072417355186" target="_blank">Facebook<i class="icon-dot bg-color7"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">Post</span><span class="pull-bottom">36</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">Tags</span><span class="pull-bottom">40</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">Categories</span><span class="pull-bottom">5</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">Trang chủ</a><a class="menu-item" href="/tags">Tags</a><a class="menu-item" href="/categories">Danh mục</a><a class="menu-item" href="/archives">Mục lục</a><a class="menu-item" href="/about">About</a></nav><div class="right-info"><a class="title-name" href="/">mhuyBlogsite</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Python Penetration Testing (Pentest)</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> Posted 2022-09-13 | Modified 2022-11-04</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"></div><div class="button-hover tags"></div></div></div><div class="main-content"><h1 id="Chapter-1-Python-with-Penetration-Testing-and-Networking"><a href="#Chapter-1-Python-with-Penetration-Testing-and-Networking" class="headerlink" title="Chapter 1: Python with Penetration Testing and Networking"></a>Chapter 1: Python with Penetration Testing and Networking</h1><h2 id="Pham-vi-cua-pentesting"><a href="#Pham-vi-cua-pentesting" class="headerlink" title="Phạm vi của pentesting"></a>Phạm vi của pentesting</h2><p>Nói đơn giản, thì pentest được sử dục cho việc đánh giá bảo mật thông tin của một công ty, một tổ chức. Bao gồm: mạng, website, cơ sở dữ liệu, máy chủ public-facing, chính sách bảo mật và mọi thứ khác do khách hàng chỉ định. Vào mỗi ngày, pentester phải trình bày báo cáo chi tiết về những phát hiện như điểm yếu, lỗ hỏng trong cơ sở hạ tầng của công ty và mức độ rủi ro của các lỗ hổng cụ thể - cung cấp giải pháp nếu có thể.</p>
<h3 id="Can-thiet-cho-pentesting"><a href="#Can-thiet-cho-pentesting" class="headerlink" title="Cần thiết cho pentesting"></a>Cần thiết cho pentesting</h3><p>Có một số điểm mô tả ý nghĩa của việc pentest:</p>
<ul>
<li>Pentest xác định những mỗi đe dọa có thể phơi bày bảo mật của một tổ chức</li>
<li>Chuyên gia pentesting đảm bảo cho tổ chức với đánh giá đầy đủ và chi tiết</li>
<li>Pentesting đánh giá hiệu quả của mạng bằng cách tạo một lượng lớn truy cập</li>
<li>Thay đổi hoặc nâng cấp cơ sở hạ tầng đang tồn tại của hardware, software hoặc network design có thể sẽ dẫn tới lỗ hổng - có thể phát hiện bởi pentesting</li>
<li>Thế giới ngày nay, các mối đe dọa tiềm năng đang giảm đáng kể; pentesting là một proactive execise để giảm thiểu cơ hội bị lợi dụng</li>
<li>Pentesting đảm bảo liệu các chính sách bảo mật phù hợp có đang được tuân thủ hay không</li>
</ul>
<p>Một tổ chức nên tiến hành một hoạt động đánh giá rủi ro trước khi pentest.</p>
<p>Có thể sử dụng những tool trên chợ, có thể tự tạo tool nhờ kiến thức lập trình - Chọn python.</p>
<h3 id="Dinh-nghia-pham-vi-cua-pentesting"><a href="#Dinh-nghia-pham-vi-cua-pentesting" class="headerlink" title="Định nghĩa phạm vi của pentesting"></a>Định nghĩa phạm vi của pentesting</h3><ul>
<li><p>You should develop the scope of the project by consulting with the client. For example, if Bob (the client) wants to test the entire network infrastructure of the organization, then pentester Alice would define the scope of pentesting by taking this network into account. Alice will consult Bob on whether any sensitive or restricted areas should be included or not.</p>
</li>
<li><p>You should take into account time, people, and money.</p>
</li>
<li><p>You should profile the test boundaries on the basis of an agreement signed by the pentester and the client.</p>
</li>
<li><p>Changes in business practice might affect the scope. For example, the addition of a subnet, new system component installations, the addition or modification of a web server, and so on, might change the scope of pentesting.</p>
</li>
</ul>
<p>2 loại pentesting:</p>
<ul>
<li>A non-destructive test: <ul>
<li>Tìm kiếm lỗ hổng tiềm ẩn - quét và xác định hệ thống từ xa</li>
<li>Điều tra và xác minh phát hiện</li>
<li>Khai thác thích hợp, lập bản đồ lỗ hổng</li>
<li>Khai thác hệ thống từ xa 1 cách cẩn thận</li>
<li>Cung cấp bằng chứng về khái niệm</li>
<li>Không cố gắng tấn công DoS</li>
</ul>
</li>
<li>A destructive test: <ul>
<li>Cố gắng tấn công DoS và tràn bộ nhớ đệm - có thể gây hỏng bộ nhớ</li>
</ul>
</li>
</ul>
<h3 id="Cac-cach-tiep-can-de-pentesting"><a href="#Cac-cach-tiep-can-de-pentesting" class="headerlink" title="Các cách tiếp cận để pentesting:"></a>Các cách tiếp cận để pentesting:</h3><p>Có 3 cách tiếp cận để pentesting:</p>
<ul>
<li>Black-box pentesting:<ul>
<li>Chỉ được cung cấp tên công ty</li>
<li>Như là hacking với kiến thức của một attacker bên ngoài</li>
<li>Bạn không cần biết trước bất kì một kiến thức nào của hệ thống</li>
<li>Tiêu tốn thời gian</li>
</ul>
</li>
<li>White-box pentesting:<ul>
<li>Bạn sẽ được cung cấp kiến thức hoàn chỉnh của cơ sở hạ tầng cần test</li>
<li>Giống như một nhân viên xấu có kiến thức phong phú về cơ sở hạ tầng của công ty</li>
<li>Được cung cấp thông tin trên cơ sở hạ tầng của công ty, network type, chính sách, được làm và không, địa chỉ IP, và IPS&#x2F;IDS firewall</li>
</ul>
</li>
<li>Gray-box pentesting:<ul>
<li>Tester thường có thông tin hạn chế về mạng &#x2F; hệ thống mục tiêu được khách hàng cung cấp để giảm chi phí và giảm thử nghiệm - sai sót trên một phần của tầng áp dụng</li>
<li>Nó thực hiện đánh giá bảo mật và kiểm tra nội bộ<h2 id="Network-Sockets"><a href="#Network-Sockets" class="headerlink" title="Network Sockets"></a>Network Sockets</h2></li>
</ul>
</li>
</ul>
<p>Một địa chỉ network socket bao gồm địa chỉ IP và Port. Một cách đơn giản, một socket là một cách để nói chuyện với một máy tính kahsc. Bằng việc định nghĩa một socket, một quá trình có thể giao tiếp với một quá trình khác trong mạng.</p>
<p>Để tạo một socket, sử dụng socket.socket():</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket (socket_family, socket_type, protocol=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Đây là mô tả của parameters:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket_family: socket.AF_INET, PF_PACKET</span><br></pre></td></tr></table></figure>
<p>AF_INET là địa chỉ IPv4, PF_PACKET hoạt động ở driver layer thiết bị. Thư viện pcap cho Linux sử dụng PF_PACKET.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Socket_type : socket.SOCK_DGRAM, socket.SOCK_RAW,socket.SOCK_STREAM</span><br></pre></td></tr></table></figure>

<ul>
<li>socket.bind(address)</li>
<li>socket.listen(q)</li>
<li>socket.accept()</li>
<li>socket.recv(bufsize)</li>
<li>socket.recvfrom(bufsize)</li>
<li>socket.recv_into(buffer)</li>
<li>socket.recvfrom_into(buffer)</li>
<li>socket.send(bytes)</li>
<li>socket.sendto(data, address)</li>
<li>socket.sendall(data)</li>
</ul>
<h3 id="Moving-on-to-the-practical"><a href="#Moving-on-to-the-practical" class="headerlink" title="Moving on to the practical"></a>Moving on to the practical</h3><p>Trước tiên, tạo một chương trình server-side cung cấp một kết nối tới khách hàng và gửi một tin nhắn tới khách hàng. Chạy server1.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span> <span class="comment">#Server address</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment">#Port of Server</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host,port)) <span class="comment">#bind server </span></span><br><span class="line">s.listen(<span class="number">2</span>) </span><br><span class="line">conn, addr = s.accept()  </span><br><span class="line"><span class="built_in">print</span>(addr, <span class="string">&#x27;Now Connected&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">&#x27;Thank you for connecting&#x27;</span>.encode())</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>Explain:<br>First, import the socket module and define the host and port number, 192.168.0.1 is the server’s IP address. Socket.AF_INET defines the IPv4 protocol’s family. Socket.SOCK_STREAM defines the TCP connection. The s.bind((host,port)) statement takes only one argument. It binds the socket to the host and port number. The s.listen(2) statement listens to the connection and waits for the client. The conn, addr &#x3D; s.accept() statement returns two values: conn and addr. The conn socket is the client socket, as we discussed earlier. The conn.send() function sends the message to the client. Finally, conn.close() closes the socket. From the following examples and screenshot, you will understand conn better.</p>
<p>client1.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span>  <span class="comment"># server address</span></span><br><span class="line">port = <span class="number">12345</span>  <span class="comment">#server port </span></span><br><span class="line">s.connect((host,port)) </span><br><span class="line"><span class="built_in">print</span>(s.recv(<span class="number">1024</span>))</span><br><span class="line">s.send(<span class="string">&#x27;Hello Server&#x27;</span>.encode())</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>Sử dụng vòng lặp while để tạo server không bị tắt, 1 server có thể gửi cho nhiều client - o, server2.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket </span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host,port))</span><br><span class="line">s.listen(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  conn, addr = s.accept()</span><br><span class="line">  <span class="built_in">print</span>(addr, <span class="string">&#x27;Now Connected&#x27;</span>)</span><br><span class="line">  conn.send(<span class="string">&#x27;Thank you for connecting&#x27;</span>.encode())</span><br><span class="line">  conn.close()</span><br></pre></td></tr></table></figure>

<p>Limit số lần truy cập:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket </span><br><span class="line"></span><br><span class="line">current_conn = <span class="number">0</span></span><br><span class="line">limit_conn = <span class="number">10</span></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host,port))</span><br><span class="line">s.listen(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">while</span> current_conn &lt; limit_conn:</span><br><span class="line">  current_conn += <span class="number">1</span></span><br><span class="line">  conn, addr = s.accept()</span><br><span class="line">  <span class="built_in">print</span>(addr, <span class="string">&#x27;Now Connected&#x27;</span>)</span><br><span class="line">  conn.send(<span class="string">&#x27;Thank you for connecting&#x27;</span>.encode())</span><br><span class="line">  conn.close()</span><br></pre></td></tr></table></figure>

<h4 id="Su-dung-bytearray-va-s-recv-into-buff"><a href="#Su-dung-bytearray-va-s-recv-into-buff" class="headerlink" title="Sử dụng bytearray() và s.recv_into(buff)"></a>Sử dụng bytearray() và s.recv_into(buff)</h4><p>Run server3.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host, port))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Connected by&#x27;</span>, addr)</span><br><span class="line">conn.send(<span class="string">&#x27;Thanks&#x27;</span>.encode())</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>Server sẽ gửi ‘Thanks’, 6 kí tự.<br>Run client3.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12345</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.connect((host, port))</span><br><span class="line">buf = <span class="built_in">bytearray</span>(<span class="string">&#x27;-&#x27;</span>.encode() * <span class="number">30</span>) <span class="comment"># Buffer created</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Number of bytes&#x27;</span>, s.recv_into(buf))</span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>

<p>socket.SOCK_DGRAM creates a UDP socket</p>
<p>Run udp1.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12346</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">s.bind((host, port))</span><br><span class="line">data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Received from &#x27;</span>, addr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Obtained &#x27;</span>, data)</span><br><span class="line"></span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<p>Run udp2.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12346</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="built_in">print</span>(s.sendto(<span class="string">&#x27;Hello mhuyyy!&#x27;</span>.encode(), (host, port)))</span><br><span class="line">s.close</span><br></pre></td></tr></table></figure>
<p>s.settimeout(5) - Sau 5s không có kết nối thì tự đóng kết nối</p>
<h4 id="Socket-exception"><a href="#Socket-exception" class="headerlink" title="Socket exception"></a>Socket exception</h4><p>Sử dụng try catch except với settimeout:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">host = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">port = <span class="number">12346</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  </span><br><span class="line">  s.bind((host,port))</span><br><span class="line">  s.settimeout(<span class="number">5</span>)</span><br><span class="line">  data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;recevied from &#x27;</span>,addr)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;obtained &#x27;</span>, data)</span><br><span class="line">  s.close()</span><br><span class="line">  </span><br><span class="line"><span class="keyword">except</span> socket.timeout :</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;Client not connected&#x27;</span>)</span><br><span class="line">  s.close()</span><br></pre></td></tr></table></figure>
<p>Sau 5 giây không kết nối, server sẽ trả về dòng chữ Client not connected</p>
<p>Thư viện python còn hỗ trợ nhiều exception socket khác:</p>
<ul>
<li>exception socket.herror: This block catches the address-related error.</li>
<li>exception socket.timeout: This block catches the exception when a timeout on a socket occurs, which has been - enabled by settimeout(). In the previous example, you can see that we used socket.timeout.</li>
<li>exception socket.gaierror: This block catches any exception that is raised due to getaddrinfo() and getnameinfo().</li>
<li>exception socket.error: This block catches any socket-related errors. If you are not sure about any - exception, you could use this. In other words, you can say that it is a generic block and can catch any type of exception.<h4 id="Userful-socket-methods"><a href="#Userful-socket-methods" class="headerlink" title="Userful socket methods"></a>Userful socket methods</h4></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">socket.gethostbyname(<span class="string">&#x27;facebook.com&#x27;</span>) <span class="comment"># &#x27;31.13.75.35&#x27;</span></span><br><span class="line">socket.gethostbyname_ex(<span class="string">&#x27;facebook.com&#x27;</span>) <span class="comment"># (&#x27;facebook.com&#x27;, [], [&#x27;31.13.75.35&#x27;])</span></span><br><span class="line">socket.gethostname() <span class="comment"># &#x27;TaMinhHuy&#x27;</span></span><br><span class="line">socket.gethostbyname(socket.gethostname()) <span class="comment"># Get your pc IP &#x27;26.36.128.153&#x27;</span></span><br><span class="line">socket.gethostbyname_ex(socket.gethostname()) <span class="comment"># (&#x27;TaMinhHuy&#x27;, [], [&#x27;192.168.255.1&#x27;, &#x27;192.168.43.1&#x27;, &#x27;172.22.80.1&#x27;, &#x27;26.36.128.153&#x27;, &#x27;192.168.88.106&#x27;])</span></span><br><span class="line">socket.getfqdn(<span class="string">&#x27;facebook.com&#x27;</span>) <span class="comment"># &#x27;edge-star-mini-shv-02-hkt1.facebook.com&#x27; - Fully quailified domain name (FQDN)</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>socket.connect_ex(address): Trả ra error indicator. Nếu thành công, nó trả ra 0; Còn khoongm nó trả ra biến errno. Bạn có thể dùng nó để scan port. Chạy connect_ex.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">rmip =<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">portlist = [<span class="number">22</span>,<span class="number">23</span>,<span class="number">80</span>,<span class="number">912</span>,<span class="number">135</span>,<span class="number">445</span>,<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> portlist:</span><br><span class="line">	sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">	result = sock.connect_ex((rmip,port))</span><br><span class="line">	<span class="built_in">print</span>(port,<span class="string">&#x27;:&#x27;</span>, result)</span><br><span class="line">	sock.close()</span><br></pre></td></tr></table></figure>

<p>Kết quả:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">22 : 10061</span><br><span class="line">23 : 10061</span><br><span class="line">80 : 0</span><br><span class="line">912 : 0</span><br><span class="line">135 : 0</span><br><span class="line">445 : 0</span><br><span class="line">20 : 10061</span><br></pre></td></tr></table></figure>
<p>Port 80, 912, 135, 445 đang được mở</p>
<p>socket.getaddrinfo method:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; socket.getaddrinfo(<span class="string">&#x27;www.facebook.com&#x27;</span>, <span class="string">&#x27;http&#x27;</span>)</span><br><span class="line">[(&lt;AddressFamily.AF_INET: 2&gt;, &lt;SocketKind.SOCK_STREAM: 1&gt;, 0, <span class="string">&#x27;&#x27;</span>, (<span class="string">&#x27;31.13.75.35&#x27;</span>, 80))]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h1 id="Chapter-2-Scanning-Pentesting"><a href="#Chapter-2-Scanning-Pentesting" class="headerlink" title="Chapter 2: Scanning Pentesting"></a>Chapter 2: Scanning Pentesting</h1><h2 id="How-to-check-live-systems-in-a-network-and-the-concept-of-a-live-system"><a href="#How-to-check-live-systems-in-a-network-and-the-concept-of-a-live-system" class="headerlink" title="How to check live systems in a network and the concept of a live system"></a>How to check live systems in a network and the concept of a live system</h2><h3 id="Ping-sweep"><a href="#Ping-sweep" class="headerlink" title="Ping sweep"></a>Ping sweep</h3><p>Ping sweep được sử dụng để định danh máy chủ live từ phạm vi của địa chỉ IP bằng việc gửi ICMP ECHO request và ICMP ECHO reply. Từ subnet và địa chỉ mạng, một attacker hoặc pentester có thể tính toán phạm vi mạng. Ở section này, tôi sẽ trình bày cách tận dụng ping của hệ điều hành</p>
<p>Từ đó chúng ta có thể viết một chương trình kiểm tra 1 loạt địa chỉ IP liền kề nhau có đang LIVE hay không:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">net = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">net1 = net.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">a = <span class="string">&#x27;.&#x27;</span></span><br><span class="line">net2 = net1[<span class="number">0</span>] + a + net1[<span class="number">1</span>] + a + net1[<span class="number">2</span>] + a</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(net2)</span><br><span class="line">st1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Enter the Starting Number: &#x27;</span>))</span><br><span class="line">en1 = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Enter the End Number: &#x27;</span>))</span><br><span class="line"></span><br><span class="line">en1 = en1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">oper = platform.system()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(oper == <span class="string">&#x27;Windows&#x27;</span>):</span><br><span class="line">    ping1 = <span class="string">&#x27;ping -n 1 &#x27;</span></span><br><span class="line"><span class="keyword">elif</span>(oper == <span class="string">&#x27;Linux&#x27;</span>):</span><br><span class="line">    ping1 = <span class="string">&#x27;ping -c 1 &#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ping1 = <span class="string">&#x27;ping -c 1 &#x27;</span></span><br><span class="line"></span><br><span class="line">t1 = datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Scanning in Progress...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> <span class="built_in">range</span>(st1, en1):</span><br><span class="line">    addr = net2 + <span class="built_in">str</span>(ip)</span><br><span class="line">    comm = ping1 + addr</span><br><span class="line"></span><br><span class="line">    response = os.popen(comm)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> response.readlines():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ttl&#x27;</span> <span class="keyword">in</span> line.lower():</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ttl&#x27;</span> <span class="keyword">in</span> line.lower():</span><br><span class="line">            <span class="built_in">print</span>(addr, <span class="string">&#x27;--&gt; Live&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t2 = datetime.now()</span><br><span class="line">total = t2 - t1</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Scanning complete in &quot;</span>, total)</span><br></pre></td></tr></table></figure>

<p>Nhưng ping_sweep.py chạy quá chậm, tiêu tốn quá nhiều thời gian. Python cung cấp cho bạn “multithreading”, nó sẽ làm cho chương trình của bạn nhanh hơn:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> socket, subprocess,sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; section 1 &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">net = raw_input(<span class="string">&#x27;Enter the Network Address &#x27;</span>)</span><br><span class="line">net1= net.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">a = <span class="string">&#x27;.&#x27;</span></span><br><span class="line">net2 = net1[<span class="number">0</span>]+a+net1[<span class="number">1</span>]+a+net1[<span class="number">2</span>]+a</span><br><span class="line">st1 = <span class="built_in">int</span>(raw_input(<span class="string">&#x27;Enter the Starting Number &#x27;</span>))</span><br><span class="line">en1 = <span class="built_in">int</span>(raw_input(<span class="string">&#x27;Enter the Last Number &#x27;</span>))</span><br><span class="line">en1 =en1+<span class="number">1</span></span><br><span class="line">dic = collections.OrderedDict()</span><br><span class="line">oper = platform.system()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (oper==<span class="string">&#x27;Windows&#x27;</span>):</span><br><span class="line">  ping1 = <span class="string">&#x27;ping -n 1 &#x27;</span></span><br><span class="line"><span class="keyword">elif</span> (oper== <span class="string">&#x27;Linux&#x27;</span>):</span><br><span class="line">  ping1 = <span class="string">&#x27;ping -c 1 &#x27;</span></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">  ping1 = <span class="string">&#x27;ping -c 1 &#x27;</span></span><br><span class="line">t1= datetime.now()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;section 2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myThread</span> (threading.Thread):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,st,en</span>):</span><br><span class="line">    threading.Thread.__init__(self)</span><br><span class="line">    self.st = st</span><br><span class="line">    self.en = en</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">    run1(self.st,self.en)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;section 3&#x27;&#x27;&#x27;</span>         </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run1</span>(<span class="params">st1,en1</span>):</span><br><span class="line">  <span class="comment">#print &#x27;Scanning in Progess&#x27;</span></span><br><span class="line">  <span class="keyword">for</span> ip <span class="keyword">in</span> xrange(st1,en1):</span><br><span class="line">    <span class="comment">#print &#x27;.&#x27;,</span></span><br><span class="line">    addr = net2+<span class="built_in">str</span>(ip)</span><br><span class="line">    comm = ping1+addr</span><br><span class="line">    response = os.popen(comm)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> response.readlines():</span><br><span class="line">      <span class="keyword">if</span>(line.count(<span class="string">&#x27;TTL&#x27;</span>)):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> (line.count(<span class="string">&#x27;TTL&#x27;</span>)):</span><br><span class="line">      <span class="comment">#print addr, &#x27;--&gt; Live&#x27;</span></span><br><span class="line">      dic[ip]= addr</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; Section 4  &#x27;&#x27;&#x27;</span></span><br><span class="line">total_ip =en1-st1</span><br><span class="line">tn =<span class="number">20</span>  <span class="comment"># number of ip handled by one thread</span></span><br><span class="line">total_thread = total_ip/tn</span><br><span class="line">total_thread=total_thread+<span class="number">1</span></span><br><span class="line">threads= []</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(total_thread):</span><br><span class="line">    en = st1+tn</span><br><span class="line">    <span class="keyword">if</span>(en &gt;en1):</span><br><span class="line">      en =en1</span><br><span class="line">    thread = myThread(st1,en)</span><br><span class="line">    thread.start()</span><br><span class="line">    threads.append(thread)</span><br><span class="line">    st1 =en</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;Error: unable to start thread&#x27;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;t</span></span><br><span class="line"><span class="string">Number of Threads active:&#x27;</span>, threading.activeCount()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">  t.join()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Exiting Main Thread&#x27;</span></span><br><span class="line"><span class="built_in">dict</span> = collections.OrderedDict(<span class="built_in">sorted</span>(dic.items()))</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">  <span class="built_in">print</span> <span class="built_in">dict</span>[key],<span class="string">&#x27;--&gt;&#x27;</span> <span class="string">&#x27;Live&#x27;</span></span><br><span class="line">t2= datetime.now()</span><br><span class="line">total =t2-t1</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;scanning complete in &#x27;</span> , total</span><br></pre></td></tr></table></figure>
<h1 id="Chapter-3-Sniffing-and-Penetration-Testing"><a href="#Chapter-3-Sniffing-and-Penetration-Testing" class="headerlink" title="Chapter 3: Sniffing and Penetration Testing"></a>Chapter 3: Sniffing and Penetration Testing</h1><h2 id="Introducing-a-network-sniffer"><a href="#Introducing-a-network-sniffer" class="headerlink" title="Introducing a network sniffer"></a>Introducing a network sniffer</h2><h3 id="Passive-sniffing"><a href="#Passive-sniffing" class="headerlink" title="Passive sniffing"></a>Passive sniffing</h3><h3 id="Active-sniffing"><a href="#Active-sniffing" class="headerlink" title="Active sniffing"></a>Active sniffing</h3><h2 id="Implementing-a-network-sniffer-using-Python"><a href="#Implementing-a-network-sniffer-using-Python" class="headerlink" title="Implementing a network sniffer using Python"></a>Implementing a network sniffer using Python</h2><p>struct method:</p>
<ul>
<li>struct.pack(fmt, v1, v2, …): Trả ra một chuỗi bao gồm v1, v2, được đóng gói theo định dạng đã cho</li>
<li>struct.unpack(fmt, string): Giải nén chuỗi theo định dạng đã cho</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">ms = struct.pack(<span class="string">&#x27;hhl&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(ms)</span><br><span class="line">k = struct.unpack(<span class="string">&#x27;hhl&#x27;</span>, ms)</span><br><span class="line"><span class="built_in">print</span>(k)</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/struct.html">https://docs.python.org/3/library/struct.html</a></p>
<h1 id="Chapter-4-Introducing-ARP-spoofing-and-implementing-it-using-Python"><a href="#Chapter-4-Introducing-ARP-spoofing-and-implementing-it-using-Python" class="headerlink" title="Chapter 4: Introducing ARP spoofing and implementing it using Python"></a>Chapter 4: Introducing ARP spoofing and implementing it using Python</h1><p>ARP (Address Resolution Protocol) - chuyển đổi IP thành Ethernet tương ứng. Khi một packet đến Network layer(OSI), nó có địa chỉ IP và data-link layer packet cần địa chỉ MAC của thiết bị đích. Trong trường hợp này, người gửi sử dụng ARP.</p>
<ul>
<li>The ARP request</li>
<li>The ARP reply</li>
</ul>
<h1 id="Chapter-5-Tesing-the-security-system-using-custom-packet-crafting"><a href="#Chapter-5-Tesing-the-security-system-using-custom-packet-crafting" class="headerlink" title="Chapter 5: Tesing the security system using custom packet crafting"></a>Chapter 5: Tesing the security system using custom packet crafting</h1><p>Ở chapter 2,  Scanning pentesting, bạn đã thấy port scanner, làm việc dựa trên TCP connect scan. Three-way handshake là khái niệm cơ bản của TCP connect scan.</p>
<h2 id="A-Half-open-scan"><a href="#A-Half-open-scan" class="headerlink" title="A Half-open scan"></a>A Half-open scan</h2><p>Kĩ thuật này được sử dụng để vượt qua các quy tắc tường lửa và tránh bị phát hiện bởi hệ thống ghi nhật ký.</p>
<p>Sử dụng thư viện scapy - giúp tạo custom-made packets.</p>
<p>Các bước:</p>
<ol>
<li>The client sends a SYN packet to the server on the intended port</li>
<li>If the port is open, then the server responds with the SYN&#x2F;ACK packet</li>
<li>If the server responds with an RST packet, it means the port is closed</li>
<li>The client sends the RST to close the initiation</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line">ip1 = IP(src=<span class="string">&#x27;192.168.0.10&#x27;</span>, dst =<span class="string">&#x27;192.168.0.3&#x27;</span> )</span><br><span class="line">tcp1 = TCP(sport =<span class="number">1024</span>, dport=<span class="number">80</span>, flags=<span class="string">&#x27;S&#x27;</span>, seq=<span class="number">12345</span>)</span><br><span class="line">packet = ip1/tcp1</span><br><span class="line">p =sr1(packet, inter=<span class="number">1</span>)</span><br><span class="line">p.show()</span><br><span class="line"></span><br><span class="line">rs1 = TCP(sport =<span class="number">1024</span>, dport=<span class="number">80</span>, flags=<span class="string">&#x27;R&#x27;</span>, seq=<span class="number">12347</span>)</span><br><span class="line">packet1=ip1/rs1</span><br><span class="line">p1 = sr1(packet1)</span><br><span class="line">p1.show()</span><br></pre></td></tr></table></figure>




</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ta Minh Huy</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://huytm2k3.github.io/2022/09/13/Python-Penetration-Testing-Pentest/">https://huytm2k3.github.io/2022/09/13/Python-Penetration-Testing-Pentest/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated. Reprint please indicate from <a href="https://huytm2k3.github.io">mhuyBlogsite</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2022/09/20/CompTIA-Network/"><i class="fas fa-angle-left">&nbsp;</i><span>CompTIA Network</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2022/08/06/Machine-learning-co-ban/"><span>Machine learning cơ bản</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2022 By Ta Minh Huy</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--></body></html>